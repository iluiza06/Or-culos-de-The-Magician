<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Or√°culos de The Magician</title>

  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800&family=Inter:wght@500;700;800&family=Great+Vibes&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- fundo gal√°xia -->
  <canvas id="bg-nebula" aria-hidden="true"></canvas>
  <canvas id="bg-stars" aria-hidden="true"></canvas>

  <!-- topo -->
  <div class="header">
    <div class="row">
      <div class="sigil" aria-hidden="true"></div>
      <a href="#inicio" class="brand">
        <div class="name">Or√°culos de The Magician</div>
      </a>
    </div>
  </div>

  <!-- faixa roxa -->
  <div class="ribbon">
    <div class="page">
      <!-- HERO -->
      <section id="inicio" class="hero">
        <h1 class="h1">Or√°culos, Feiti√ßos & Ritual√≠stica para guiar sua jornada</h1>
        <p class="sub">Tar√¥, runas e rituais coletivos ‚Äî com sensibilidade, √©tica e beleza.</p>
        <div class="chips">
          <a href="#consultas" class="chip">üÉè Consultas</a>
          <a href="#feiticos" class="chip">‚ú® Feiti√ßos</a>
          <a href="#promocoes" class="chip">üéÅ Promo√ß√£o</a>
        </div>

        <!-- SOBRE MIM -->
        <section class="section about">
          <h2>üåô Sobre Mim</h2>
          <div class="about-grid card">
            <div class="about-text">
              <p class="muted"></p>
              <ul class="about-list"></ul>
            </div>
          </div>
        </section>
      </section>

      <!-- CONSULTAS -->
      <section id="consultas" class="section">
        <h2>Consultas & Or√°culos</h2>
        <div class="carousel">
          <button class="arrow left" data-to="#c1">‚Äπ</button>
          <div class="rail" id="c1"></div>
          <button class="arrow right" data-to="#c1">‚Ä∫</button>
        </div>
      </section>

      <!-- FEITI√áOS -->
      <section id="feiticos" class="section">
        <h2>Feiti√ßos & Ritual√≠stica</h2>
        <div class="carousel">
          <button class="arrow left" data-to="#c2">‚Äπ</button>
          <div class="rail" id="c2"></div>
          <button class="arrow right" data-to="#c2">‚Ä∫</button>
        </div>
        <div class="space"></div>
      </section>

      <!-- AGENDA -->
      <section id="agenda" class="section">
        <h2>Agenda Coletiva</h2>
        <div class="card">
          <div style="display:flex; gap:22px; flex-wrap:wrap; justify-content:center; text-align:center">
            <div>
              <div style="font-family:'Playfair Display',serif;font-weight:800;font-size:28px" id="d">--</div>
              <div class="muted">dias</div>
            </div>
            <div>
              <div style="font-family:'Playfair Display',serif;font-weight:800;font-size:28px" id="h">--</div>
              <div class="muted">horas</div>
            </div>
            <div>
              <div style="font-family:'Playfair Display',serif;font-weight:800;font-size:28px" id="m">--</div>
              <div class="muted">min</div>
            </div>
          </div>
          <div class="space"></div>
          <div style="display:flex; justify-content:center">
            <a class="btn" href="#contato">Reservar sua vaga <span class="spark"></span></a>
          </div>
          <p class="muted" style="margin:10px 0 0; text-align:center">
            Pr√≥xima data: <span id="ritualDate" style="color:var(--gold-300)"></span>
          </p>
        </div>
      </section>

      <!-- PROMO -->
      <section id="promocoes" class="section">
        <h2>Promo√ß√µes & Cupons</h2>
        <div class="promo">
          <h3 id="promoTitle" style="margin:4px 0 6px">Promo√ß√£o</h3>
          <p id="promoSubtitle" style="margin:0 0 10px"></p>

          <form onsubmit="event.preventDefault(); ativarCupom();">
            <div class="grid">
              <input id="cupom" placeholder="Digite seu cupom m√°gico (ex.: ROSADOURADA)" aria-label="Cupom" />
              <button class="btn" type="submit">Ativar <span class="spark"></span></button>
            </div>
          </form>
        </div>
      </section>

      <!-- DEPOIMENTOS -->
      <section id="depoimentos" class="section">
        <h2>Depoimentos</h2>
        <div class="carousel">
          <button class="arrow left" data-to="#c3" aria-label="Anterior">‚Äπ</button>
          <div class="rail" id="c3"></div>
          <button class="arrow right" data-to="#c3" aria-label="Pr√≥ximo">‚Ä∫</button>
        </div>
      </section>

      <!-- CONTATO -->
      <section id="contato" class="section">
        <h2>Contato</h2>
        <p class="muted" style="margin:0 0 8px">Preencha o formul√°rio ou fale direto no WhatsApp.</p>
        <div class="card" style="margin-bottom:12px">
          <form onsubmit="enviarWhatsapp(event)">
            <div style="display:grid; gap:10px; grid-template-columns:1fr 1fr">
              <input id="nome" required placeholder="Seu nome" />
              <select id="assunto" required>
                <option value="" selected disabled>Assunto</option>
                <option value="pergunta1">1 Pergunta</option>
                <option value="perguntas3">3 Perguntas</option>
                <option value="perguntas6">6 Perguntas</option>
                <option value="mesa">Mesa Aberta</option>
                <option value="limpeza">Equil√≠brio & Limpeza</option>
                <option value="prosperidade">Abertura de Caminhos</option>
                <option value="banimento">Cortes & Prote√ß√£o</option>
                <option value="duvida">D√∫vida geral</option>
              </select>
            </div>
            <div class="space"></div>
            <textarea required placeholder="Sua mensagem"></textarea>
            <div class="space"></div>
            <button class="btn" type="submit">Enviar <span class="spark"></span></button>
          </form>
        </div>

        <div class="card">
          <h3 style="margin:0 0 6px; color:var(--gold-300)">Redes & WhatsApp</h3>
          <div style="display:flex; gap:8px; flex-wrap:wrap">
            <a class="btn" style="background:linear-gradient(180deg,#aef7a6,#5df072)"
              href="https://wa.me/5579998234443?text=Ol√°!%20Quero%20agendar%20uma%20consulta%20/%20feiti√ßo.">üí¨ WhatsApp
              <span class="spark"></span></a>
            <a class="btn" href="https://www.instagram.com/le._bateleur?igsh=MnVjbG05cDM0Y29h" target="_blank">
              üì∏ Instagram <span class="spark"></span>
            </a>
          </div>
        </div>
      </section>

      <!-- RODAP√â -->
      <div class="footer">
        <p class="scripted">A magia acontece quando voc√™ acredita.</p>
        <p class="muted">¬© <span id="year"></span> Or√°culos de The Magician. Todos os direitos reservados.</p>
      </div>
    </div>
  </div>

  <!-- bot√£o flutuante whatsapp -->
  <a title="WhatsApp" href="https://wa.me/5579998234443?text=Ol√°!%20Quero%20agendar%20uma%20consulta%20/%20feiti√ßo."
    style="position:fixed; left:16px; bottom:calc(var(--tabbar-h) + 18px); width:56px; height:56px; border-radius:50%; display:grid; place-items:center; z-index:65; text-decoration:none; background:linear-gradient(180deg,#aef7a6,#5df072); color:#0b1b0f; font-weight:900; box-shadow:0 10px 18px rgba(20,255,88,.2)">üí¨</a>

  <!-- ===== SCRIPTS DO SITE (gal√°xia, atalhos, contato, carross√©is) ===== -->
  <script>
    // ano no rodap√©
    document.getElementById('year').textContent = new Date().getFullYear();

    // ====== GAL√ÅXIA ANIMADA ======
    const cnvN = document.getElementById('bg-nebula');
    const cnvS = document.getElementById('bg-stars');
    const nctx = cnvN.getContext('2d');
    const sctx = cnvS.getContext('2d');
    let W = 0, H = 0;
    function resize() {
      W = cnvN.width = cnvS.width = innerWidth;
      H = cnvN.height = cnvS.height = innerHeight;
    }
    resize(); addEventListener('resize', resize);

    const blobs = Array.from({ length: 6 }, (_, i) => ({
      x: Math.random() * 1.2 - 0.1,
      y: Math.random() * 1.2 - 0.1,
      r: (i < 2 ? 0.9 : (i < 4 ? 0.7 : 0.55)),
      c: ['#2a1546', '#3b1d6a', '#6d2e8f', '#a03abf', '#d768ff'][i % 5],
      a: Math.random() * Math.PI * 2,
      v: (Math.random() * 0.4 + 0.1) * (Math.random() < .5 ? -1 : 1)
    }));

    function drawNebula(t = 0) {
      nctx.clearRect(0, 0, W, H);
      const g = nctx.createRadialGradient(W * .5, H * .5, Math.min(W, H) * .1, W * .5, H * .5, Math.max(W, H) * .8);
      g.addColorStop(0, '#12152a'); g.addColorStop(1, '#0b0713');
      nctx.fillStyle = g; nctx.fillRect(0, 0, W, H);
      blobs.forEach((b, idx) => {
        const px = (b.x + Math.sin(t * 0.00008 + idx) * 0.015) * W;
        const py = (b.y + Math.cos(t * 0.00006 + idx) * 0.02) * H;
        const R = Math.max(W, H) * b.r;
        const grad = nctx.createRadialGradient(px, py, 0, px, py, R);
        grad.addColorStop(0, b.c + 'ee');
        grad.addColorStop(0.35, b.c + '55');
        grad.addColorStop(1, 'transparent');
        nctx.globalCompositeOperation = 'lighter';
        nctx.fillStyle = grad; nctx.beginPath(); nctx.arc(px, py, R, 0, Math.PI * 2); nctx.fill();
        nctx.globalCompositeOperation = 'source-over';
      });
    }

    let S = []; const COUNT = innerWidth < 360 ? 45 : (innerWidth < 480 ? 70 : (innerWidth < 768 ? 100 : 160));
    function makeStars() { S = Array.from({ length: COUNT }, () => ({ x: Math.random() * W, y: Math.random() * H, r: Math.random() * 1.6 + .3, a: Math.random(), v: Math.random() * .35 + .05 })) }
    makeStars();
    let mx = W / 2, my = H / 2;
    addEventListener('mousemove', e => { mx = e.clientX; my = e.clientY });
    addEventListener('touchmove', e => { if (e.touches?.[0]) { mx = e.touches[0].clientX; my = e.touches[0].clientY } });

    function drawStars() {
      sctx.clearRect(0, 0, W, H);
      for (const s of S) {
        s.a += s.v * .02; const tw = (1 + Math.sin(s.a)) * .5;
        const px = s.x + (mx - W / 2) * .006 * s.r; const py = s.y + (my - H / 2) * .006 * s.r;
        sctx.beginPath(); sctx.arc(px, py, s.r, 0, Math.PI * 2);
        sctx.fillStyle = `rgba(255,255,255,${.35 + tw * .55})`; sctx.fill();
      }
    }
    function loop(t) { drawNebula(t); drawStars(); requestAnimationFrame(loop) }
    requestAnimationFrame(loop);

    // ===== Carross√©is: setas movem o trilho =====
    document.querySelectorAll('.arrow').forEach(btn => {
      btn.addEventListener('click', () => {
        const sel = btn.getAttribute('data-to');
        const rail = document.querySelector(sel);
        if (!rail) return;
        const dir = btn.classList.contains('left') ? -1 : 1;
        rail.scrollBy({ left: dir * (rail.clientWidth * 0.8), behavior: 'smooth' });
      });
    });

    // ====== CONTATO -> WhatsApp ======
    function enviarWhatsapp(e) {
      e.preventDefault();
      const PHONE = "5579998234443";
      const nome = (document.getElementById('nome')?.value || '').trim();
      const assunto = document.getElementById('assunto')?.value || '';
      const textarea = document.querySelector('#contato textarea');
      const textoLivre = (textarea?.value || '').trim();
      if (assunto === 'duvida' && !textoLivre) {
        if (textarea) { textarea.placeholder = 'Descreva sua d√∫vida geral aqui...'; textarea.required = true; textarea.focus(); }
        alert('Por favor, descreva sua d√∫vida no campo "Sua mensagem".'); return;
      }
      const msgs = {
        pergunta1: "Quero agendar 1 Pergunta (resposta objetiva).",
        perguntas3: "Quero agendar 3 Perguntas (tr√™s focos com conselho).",
        perguntas6: "Quero agendar 6 Perguntas (leitura completa).",
        mesa: "Quero agendar uma Mesa Aberta (explora√ß√£o livre).",
        limpeza: "Gostaria do ritual Equil√≠brio & Limpeza.",
        prosperidade: "Gostaria do ritual Abertura de Caminhos (prosperidade).",
        banimento: "Preciso do ritual Cortes & Prote√ß√£o (banimento).",
        duvida: "Tenho uma d√∫vida geral e gostaria de orienta√ß√£o."
      };
      const assuntoTxt = msgs[assunto] || "Tenho interesse e gostaria de mais informa√ß√µes.";
      const saudacao = nome ? `Ol√°! Sou ${nome}. ` : "Ol√°! ";
      const extra = textoLivre ? `\n\nDetalhes: ${textoLivre}` : "";
      const msg = `${saudacao}${assuntoTxt}${extra}\n\n(Enviado pelo site)`;
      window.open(`https://wa.me/${PHONE}?text=${encodeURIComponent(msg)}`, '_blank');
    }

    // === Atalho secreto p/ ADMIN: 5 toques no logo ou Shift+Alt+A
    (function () {
      const TARGET = document.querySelector('.name, .brand, .sigil') || document.body;
      let taps = 0, timer = null;
      function openAdmin() { location.href = 'admin.html'; }
      function registerTap() {
        taps++;
        if (taps >= 5) { openAdmin(); return; }
        clearTimeout(timer); timer = setTimeout(() => { taps = 0; }, 3000);
      }
      TARGET.addEventListener('click', registerTap, { passive: true });
      TARGET.addEventListener('touchend', registerTap, { passive: true });
      document.addEventListener('keydown', (e) => {
        if (e.shiftKey && e.altKey && (e.key === 'A' || e.key === 'a')) openAdmin();
      });
    })();

    // util p/ criar elementos
    const el = (tag, attrs = {}, html = "") => {
      const n = document.createElement(tag);
      for (const k in attrs) n.setAttribute(k, attrs[k]);
      if (html) n.innerHTML = html;
      return n;
    };
  </script>

  <!-- ===== FIREBASE (compat) ===== -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script>
    // Config do seu projeto
    const firebaseConfig = {
      apiKey: "AIzaSyDQA4AVdZu6TNi3eobf6qWaee0Hj-zujqg",
      authDomain: "oraculos-magician.firebaseapp.com",
      projectId: "oraculos-magician",
      storageBucket: "oraculos-magician.firebasestorage.app",
      messagingSenderId: "902773742288",
      appId: "1:902773742288:web:456563b2b37bc3ba19dcd5",
      measurementId: "G-7XG7N1Q7B9"
    };

    try { firebase.initializeApp(firebaseConfig); } catch (e) { }
    const db = firebase.firestore();

    // guarda tudo o que o site carregou (cache + firestore)
    window.__siteData = { cupons: [] };

    // ===== RENDER =====
    function renderSobre(about) {
      const aboutP = document.querySelector('.about .about-text .muted');
      if (aboutP) aboutP.innerHTML = (about || "").replace(/\n/g, '<br>');
    }
    function renderConsultas(lista = []) {
      const rail = document.querySelector('#c1'); if (!rail) return;
      rail.innerHTML = "";
      (lista || []).forEach(item => {
        const card = el('article', { class: 'card card-slide' });
        if (item.badge) card.appendChild(el('span', { class: 'badge' }, item.badge));
        if (item.titulo) card.appendChild(el('h3', { style: 'margin:8px 0 4px' }, item.titulo));
        if (item.desc) card.appendChild(el('p', { class: 'muted' }, item.desc));
        if (item.preco) card.appendChild(el('div', { class: 'price' }, item.preco));
        card.appendChild(el('div', { class: 'divider' }));
        card.appendChild(el('a', { class: 'btn', href: '#contato' }, 'Agendar <span class="spark"></span>'));
        rail.appendChild(card);
      });
    }
    function renderFeiticos(lista = []) {
      const rail = document.querySelector('#c2'); if (!rail) return;
      rail.innerHTML = "";
      (lista || []).forEach(item => {
        const card = el('article', { class: 'card card-slide' });
        if (item.badge) card.appendChild(el('span', { class: 'badge' }, item.badge));
        if (item.titulo) card.appendChild(el('h3', { style: 'margin:8px 0 4px' }, item.titulo));
        if (item.desc) card.appendChild(el('p', { class: 'muted' }, item.desc));
        card.appendChild(el('a', { class: 'btn', href: '#contato' }, 'Solicitar <span class="spark"></span>'));
        rail.appendChild(card);
      });
    }
    function renderDepo(lista = []) {
      const rail = document.querySelector('#c3'); if (!rail) return;
      rail.innerHTML = "";
      (lista || []).forEach(item => {
        if (!item.img) return;
        const fig = el('figure', { class: 'testi-card card' });
        const frame = el('div', { class: 'testi-frame' });
        const img = el('img', { class: 'testi-img', src: item.img, alt: item.alt || 'Depoimento' });
        frame.appendChild(img); fig.appendChild(frame); rail.appendChild(fig);
      });
    }
    function renderAgenda(lista = []) {
      const now = new Date();
      const futuras = (lista || [])
        .map(x => (typeof x === 'string' ? { date: x, obs: '' } : x))
        .map(x => ({ d: new Date(x.date), obs: x.obs || '' }))
        .filter(o => !isNaN(o.d) && o.d >= now)
        .sort((a, b) => a.d - b.d);
      if (!futuras[0]) return;
      const d = futuras[0].d, obs = futuras[0].obs;
      const elDate = document.getElementById('ritualDate');
      if (elDate) {
        let fmt = d.toLocaleString(undefined, { dateStyle: 'medium', timeStyle: 'short' });
        if (obs) fmt += ` ‚Äî ${obs}`;
        elDate.textContent = fmt;
      }
      const nd = d.getTime();
      const elD = document.getElementById('d'), elH = document.getElementById('h'), elM = document.getElementById('m');
      if (elD && elH && elM) {
        function tick() {
          const t = nd - Date.now();
          if (t <= 0) return;
          elD.textContent = Math.floor(t / 86400000);
          elH.textContent = Math.floor((t % 86400000) / 3600000);
          elM.textContent = Math.floor((t % 3600000) / 60000);
          requestAnimationFrame(tick);
        }
        tick();
      }
    }

    // ===== CUPOM + MODAL =====
    function showModal(msg) {
      const m = document.getElementById('modal-cupom');
      const t = document.getElementById('modal-text');
      t.textContent = msg;
      m.style.display = 'grid';
      setTimeout(() => { m.style.display = 'none'; }, 2500);
    }
    window.ativarCupom = function () {
      const inp = document.getElementById('cupom');
      const val = (inp?.value || '').trim().toUpperCase();
      if (!val) { showModal('Digite um cupom.'); return; }
      const all = (window.__siteData?.cupons) || [];
      const ok = all.find(c => (c.codigo || '').toUpperCase() === val && !!c.ativo);
      if (ok) {
        localStorage.setItem('tm_cupom_aplicado', val);
        const descricao = ok.desconto || ok.desc || "";
        const extra = descricao ? ` (${descricao})` : "";
        showModal(`Cupom aplicado: ${ok.codigo}${extra}`);
        const msg = `Ol√°! Quero usar o cupom ${ok.codigo}${extra} nas minhas consultas/rituais.`;
        const url = `https://wa.me/5579998234443?text=${encodeURIComponent(msg)}`;
        window.open(url, '_blank');
      } else {
        showModal('Cupom inv√°lido ou inativo.');
      }
    };

    // ===== Carregar do Firestore (com fallback localStorage) =====
    async function carregarSite() {
      // cache local (r√°pido)
      try {
        const raw = localStorage.getItem('tm_data');
        if (raw) {
          const cached = JSON.parse(raw);
          window.__siteData = cached;
          renderPromo(cached.promo);
          renderSobre(cached.about);
          renderConsultas(cached.consultas);
          renderFeiticos(cached.feiticos);
          renderDepo(cached.depoimentos);
          renderAgenda(cached.agenda);

        }
      } catch (e) { }
      // oficial
      try {
        db.collection("siteData").doc("conteudo").onSnapshot((snap) => {
          if (!snap.exists) return;
          const data = snap.data() || {};
          window.__siteData = data;

          // atualiza o cache local tamb√©m (pra evitar ‚Äúver velho‚Äù depois)
          localStorage.setItem('tm_data', JSON.stringify(data));

          renderSobre(data.about);
          renderConsultas(data.consultas);
          renderFeiticos(data.feiticos);
          renderDepo(data.depoimentos);
          renderAgenda(data.agenda);
          renderPromo(data.promo);

        }, (err) => {
          console.warn("N√£o foi poss√≠vel ouvir Firestore.", err);
        });

      } catch (e) {
        console.warn("N√£o foi poss√≠vel carregar do Firestore.", e);
      }
    }
    carregarSite();

    // auto-recarregar se admin publicar em outra aba local
    window.addEventListener('storage', (e) => {
      if (e.key === 'tm_data' || e.key === 'tm_ping') location.reload();
    });
  </script>

  <!-- Modal/Toast de confirma√ß√£o de cupom -->
  <div id="modal-cupom" style="
    display:none; position:fixed; inset:0; z-index:9999; 
    place-items:center; background:rgba(0,0,0,.25);">
    <div style="
      max-width:90vw; padding:14px 18px; border-radius:14px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.15);
      color:#f7e9a3; font-weight:700; text-align:center;">
      <span id="modal-text">Mensagem</span>
    </div>
  </div>
</body>

</html>